{{- if (index . "installTmux" | default false) -}}
# ~/.tmux.conf - managed by chezmoi

# =============================================================================
# General Settings
# =============================================================================

# True color support
set -g default-terminal "screen-256color"
set -ga terminal-overrides ",*256col*:Tc"

# Mouse support
set -g mouse on

# History
set -g history-limit 50000

# Faster command sequences
set -sg escape-time 0

# Display time
set -g display-time 4000

# Status refresh
set -g status-interval 5

# Focus events
set -g focus-events on

set -g allow-passthrough on
set -ga update-environment TERM
set -ga update-environment TERM_PROGRAM
# =============================================================================
# Window/Pane Settings
# =============================================================================

# Start indexing from 1
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when one is closed
set -g renumber-windows on

# =============================================================================
# Key Bindings
# =============================================================================

# Change prefix to backtick (`)
unbind C-b
set -g prefix `
bind ` send-prefix

# Split panes with | and -
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
unbind '"'
unbind %

# Vim-like pane navigation
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Vim-like pane resizing
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Reload config
bind r source-file ~/.tmux.conf \; display "Config reloaded!"

# New window in current path
bind c new-window -c "#{pane_current_path}"

# fzf session/window picker with fzf popup
#bind f display-popup -E "tmux list-windows -a -F '#{session_name}:#{window_index} │ #{window_name}#{?window_active, ←,}#{?session_attached, [attached],}' | fzf --prompt='tmux > ' --preview='tmux capture-pane -t {1} -p 2>/dev/null | head -30' --preview-window=right:50%:wrap | cut -d' ' -f1 | xargs -I{} tmux switch-client -t {}"

bind b display-popup -E "nvim ~/scratch.md +"
bind n display-popup "numr"
bind m display-popup "mods -C"

bind space run-shell "~/work/jelpalette/scripts/toggle.sh"
bind y setw synchronize-panes

# =============================================================================
# Status Bar
# =============================================================================

set -g status-style 'bg=#333333 fg=#ffffff'
set -g status-position bottom
set -g status-justify left
set -g status-left-length 40
set -g status-right-length 50

set -g status-left '#[fg=#00ff00,bold]#S #[fg=#ffffff]| '
set -g status-right '#[fg=#888888]%Y-%m-%d #[fg=#ffffff]%H:%M'

set -g status-interval 60
WEATHER='#(curl -s wttr.in/Alicante\?format\="%%l:+%%c%%20%%t%%60%%w&period=60")'
set -g status-right "$WEATHER | #[fg=#888888]%Y-%m-%d #[fg=#ffffff]%H:%M"

# Window status
setw -g window-status-format ' #I:#W '
setw -g window-status-current-format '#[fg=#00ff00,bold] #I:#W '

# =============================================================================
# Pane Border
# =============================================================================

# set -g pane-border-style 'fg=#444444'
# set -g pane-active-border-style 'fg=#00ff00'
set -g pane-border-style fg=magenta
set -g pane-active-border-style "bg=default fg=magenta"

# =============================================================================
# Plugins (via TPM)
# =============================================================================

set -g @plugin 'tmux-plugins/tpm'

# Sensible defaults
set -g @plugin 'tmux-plugins/tmux-sensible'

# Command palette
# set -g @plugin 'sainnhe/tmux-fzf'

# Persist sessions across restarts
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'

set -g @resurrect-capture-pane-contents 'on'
# set -g @plugin 'alexwforsythe/tmux-which-key'

run '~/.tmux/plugins/tpm/tpm'
{{- end }}
