{{- if and (hasKey . "installZsh") .installZsh -}}
#!/usr/bin/env bash
#
# Configure zsh as default shell
# oh-my-zsh is installed via .chezmoiexternal.toml
#
# This script only runs once (per machine)

set -euo pipefail

echo "==> Configuring zsh..."

# Change default shell to zsh if not already
if [[ "$SHELL" != *"zsh"* ]]; then
    ZSH_PATH="$(which zsh)"
    echo "Changing default shell to zsh..."
    
    # Check if zsh is in /etc/shells
    if ! grep -q "$ZSH_PATH" /etc/shells 2>/dev/null; then
        echo "$ZSH_PATH" | sudo tee -a /etc/shells >/dev/null
    fi
    
    # Try chsh, handle WSL case
    if chsh -s "$ZSH_PATH" 2>/dev/null; then
        echo "Default shell changed to zsh"
    else
        echo "Could not change shell via chsh"
        echo "You may need to run: chsh -s \$(which zsh)"
    fi
else
    echo "zsh is already the default shell"
fi

echo "==> zsh configured!"
{{- end }}
