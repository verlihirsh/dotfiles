{{- /* User identity */ -}}
{{- $name := promptStringOnce . "name" "Your full name" -}}
{{- $email := promptStringOnce . "email" "Your email address" -}}

{{- /* Tool selections */ -}}
{{- $installZsh := promptBoolOnce . "installZsh" "Install zsh + oh-my-zsh" -}}
{{- $installPython := promptBoolOnce . "installPython" "Install Python via uv (fast, modern Python manager)" -}}
{{- $installNode := promptBoolOnce . "installNode" "Install Node.js via fnm" -}}
{{- $installNeovim := promptBoolOnce . "installNeovim" "Install Neovim with jelvim config" -}}
{{- $installTmux := promptBoolOnce . "installTmux" "Install and configure tmux" -}}
{{- $installDirenv := promptBoolOnce . "installDirenv" "Install direnv" -}}
{{- $installLspServers := promptBoolOnce . "installLspServers" "Install LSP servers (for Neovim/editors)" -}}
{{- $installOpencode := promptBoolOnce . "installOpencode" "Install OpenCode + oh-my-opencode (AI coding)" -}}
{{- $installNerdFonts := promptBoolOnce . "installNerdFonts" "Install Nerd Fonts (for terminal icons)" -}}
{{- $installStarship := promptBoolOnce . "installStarship" "Install Starship prompt (modern cross-shell prompt)" -}}
{{- $setupReverseProxy := promptBoolOnce . "setupReverseProxy" "Setup SSH reverse proxy tunnel" -}}
{{- $workspaceDir := promptStringOnce . "workspaceDir" "Workspace directory (for projects, code, etc.)" -}}

{{- /* CLI Tools - Multi-select */ -}}
{{- $cliToolChoices := list
    "fzf - fuzzy finder"
    "ripgrep - fast grep"
    "fd - fast find"
    "bat - cat with syntax highlighting"
    "eza - modern ls"
    "jq - JSON processor"
    "htop - process viewer"
    "tree - directory tree"
    "zoxide - smart cd"
    "neofetch - system info"
    "glow - markdown reader"
    "fx - JSON viewer"
    "lazysql - database TUI"
-}}
{{- $defaultCliTools := list
    "fzf - fuzzy finder"
    "ripgrep - fast grep"
    "fd - fast find"
    "bat - cat with syntax highlighting"
    "eza - modern ls"
    "jq - JSON processor"
    "zoxide - smart cd"
-}}
{{- $selectedCliTools := promptMultichoiceOnce . "selectedCliTools" "Select CLI tools to install (use arrow keys + space)" $cliToolChoices $defaultCliTools -}}

{{- /* Reverse proxy configuration */ -}}
{{- $vpsHost := "" -}}
{{- $vpsUser := "" -}}
{{- $reverseProxyRemotePort := "2222" -}}
{{- $reverseProxyLocalPort := "22" -}}
{{- if $setupReverseProxy -}}
{{-   $vpsHost = promptStringOnce . "vpsHost" "VPS hostname (e.g., vps.example.com)" -}}
{{-   $vpsUser = promptStringOnce . "vpsUser" "VPS username (e.g., user_on_vps)" -}}
{{-   $reverseProxyRemotePort = promptStringOnce . "reverseProxyRemotePort" "Remote port on VPS (default: 2222)" -}}
{{-   if eq $reverseProxyRemotePort "" -}}
{{-     $reverseProxyRemotePort = "2222" -}}
{{-   end -}}
{{-   $reverseProxyLocalPort = promptStringOnce . "reverseProxyLocalPort" "Local SSH port (default: 22)" -}}
{{-   if eq $reverseProxyLocalPort "" -}}
{{-     $reverseProxyLocalPort = "22" -}}
{{-   end -}}
{{- end -}}

{{- /* OpenCode subscription options */ -}}
{{- $opencodeClaudeMax := false -}}
{{- $opencodeClaude := false -}}
{{- $opencodeChatgpt := false -}}
{{- $opencodeGemini := false -}}
{{- if $installOpencode -}}
{{-   $opencodeClaudeMax = promptBoolOnce . "opencodeClaudeMax" "Do you have Claude Max (20x mode) subscription?" -}}
{{-   if not $opencodeClaudeMax -}}
{{-     $opencodeClaude = promptBoolOnce . "opencodeClaude" "Do you have Claude Pro subscription?" -}}
{{-   end -}}
{{-   $opencodeChatgpt = promptBoolOnce . "opencodeChatgpt" "Do you have ChatGPT subscription?" -}}
{{-   $opencodeGemini = promptBoolOnce . "opencodeGemini" "Do you have Gemini subscription?" -}}
{{- end -}}

{{- /* Version preferences */ -}}
{{- $pythonVersion := "3.12" -}}
{{- $nodeVersion := "22" -}}
{{- if $installPython -}}
{{-   $pythonVersion = promptStringOnce . "pythonVersion" "Python version(s) - space or comma separated (e.g., '3.11 3.12 3.13' or just '3.12')" -}}
{{- end -}}
{{- if $installNode -}}
{{-   $nodeVersion = promptStringOnce . "nodeVersion" "Node.js version (e.g., 22)" -}}
{{- end -}}

{{- /* Editor preference */ -}}
{{- $editor := promptStringOnce . "editor" "Default editor (nvim/vim/code)" -}}

{{- /* Secrets path (optional - for copying SSH keys, API tokens, etc.) */ -}}
{{- $secretsPath := promptStringOnce . "secretsPath" "Path to secrets folder (leave empty to skip)" -}}

{{- /* SSH key generation (if no existing secrets) */ -}}
{{- $generateSshKey := false -}}
{{- $sshKeyType := "ed25519" -}}
{{- if eq $secretsPath "" -}}
{{-   $generateSshKey = promptBoolOnce . "generateSshKey" "Generate new SSH key pair" -}}
{{-   if $generateSshKey -}}
{{-     $sshKeyType = promptStringOnce . "sshKeyType" "SSH key type (ed25519/rsa)" -}}
{{-   end -}}
{{- end -}}

[data]
    name = {{ $name | quote }}
    email = {{ $email | quote }}
    editor = {{ $editor | quote }}
    
    # Tool installations
    installZsh = {{ $installZsh }}
    installPython = {{ $installPython }}
    installNode = {{ $installNode }}
    installNeovim = {{ $installNeovim }}
    installTmux = {{ $installTmux }}
    installDirenv = {{ $installDirenv }}
    installLspServers = {{ $installLspServers }}
    installOpencode = {{ $installOpencode }}
    installNerdFonts = {{ $installNerdFonts }}
    installStarship = {{ $installStarship }}
    setupReverseProxy = {{ $setupReverseProxy }}
    workspaceDir = {{ $workspaceDir | quote }}
    
    # CLI Tools (multi-select)
    selectedCliTools = {{ $selectedCliTools | toToml }}
    
    # Reverse proxy configuration
    vpsHost = {{ $vpsHost | quote }}
    vpsUser = {{ $vpsUser | quote }}
    reverseProxyRemotePort = {{ $reverseProxyRemotePort | quote }}
    reverseProxyLocalPort = {{ $reverseProxyLocalPort | quote }}
    
    # OpenCode subscriptions
    opencodeClaudeMax = {{ $opencodeClaudeMax }}
    opencodeClaude = {{ $opencodeClaude }}
    opencodeChatgpt = {{ $opencodeChatgpt }}
    opencodeGemini = {{ $opencodeGemini }}
    
    # Versions
    pythonVersion = {{ $pythonVersion | quote }}
    nodeVersion = {{ $nodeVersion | quote }}
    
    # Secrets
    secretsPath = {{ $secretsPath | quote }}
    generateSshKey = {{ $generateSshKey }}
    sshKeyType = {{ $sshKeyType | quote }}

[git]
    autoCommit = true
    autoPush = false
    commitMessageTemplate = {{ printf "%q" " {{ promptString \"Commit message\" }}" }}

[merge]
    command = "nvim"
    args = [
        "-d",
        {{ printf "%q" "{{ .Destination }}" }},
        {{ printf "%q" "{{ .Source }}" }},
        {{ printf "%q" "{{ .Target }}" }},
    ]
